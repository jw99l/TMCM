// https://github.com/flashbots/go-boost-utils 의 테스트코드를 변경함

func TestVerifySignedBuilderBidSignatureAndWriteHashTreeRoot(t *testing.T) {
	bidStr := `{"message":{"header":{"parent_hash":"0x0544e2170998060d9560fdbf8f263a08c0a209211569a0560138522b84805abc","fee_recipient":"0x0000000000000000000000000000000000000000","state_root":"0xcded53d652660a91bfe6f5dfb017204a4cdd1598a07116b2cdea1586d603d01c","receipts_root":"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421","logs_bloom":"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","prev_randao":"0xd60955dc7f0cc7bf28d7e6c6f4859081f3a6df5ef4f70e05d70d8282bac20c6c","block_number":"960335","gas_limit":"30000000","gas_used":"0","timestamp":"1659720144","extra_data":"0x466c617368626f747320666c617368626c6f636b","base_fee_per_gas":"7","block_hash":"0xea33078b00e6b2926f45ed6d3190a3a6ada75cee342f600cf22fa02a9a2edcb7","transactions_root":"0x7ffe241ea60187fdb0187bfa22de35d1f9bed7ab061d9401fd47e34a54fbede1"},"value":"0","pubkey":"0xb5246e299aeb782fbc7c91b41b3284245b1ed5206134b0028b81dfb974e5900616c67847c2354479934fc4bb75519ee1"},"signature":"0xa775df980d589a87b234cf36b94fbcd40540ab1dffb752a013c02f636d85db60023f7e9d883de8cfdbfd94e0e3b598c01429fee50a5cb8d9fce50557baec2e9f81268f14f4f044b44b1238b7945201f036036d1a25d60e681f3737d4ef3b54b6"}`

	// Decode the bid
	bid := new(SignedBuilderBid)
	require.NoError(t, DecodeJSON(strings.NewReader(bidStr), bid))

	// Verify signature
	builderDomainKiln, err := _ComputeDomain(DomainTypeAppBuilder, GenesisForkVersionKiln, Root{}.String())
	require.NoError(t, err)

	bs, _ := bid.Message.HashTreeRoot()
	fmt.Printf("[*] block HashTreeRoot: 0x%s\n", hex.EncodeToString(bs[:]))
	ok, err := VerifySignature(bid.Message, builderDomainKiln, bid.Message.Pubkey[:], bid.Signature[:])
	require.NoError(t, err)
	require.True(t, ok)
}

/*
[*] block HashTreeRoot: 0xe0a3f215cfa7f9d75f9388aaa154c0f000734f3794816f2986b90aa256addf4f
*/
